<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CPTDB Photo Stream</title>
    <script src="https://cdn.jsdelivr.net/npm/epoxy-tls-polyfill@1/dist/javascript.min.js"></script>
    <style>
        * {
            touch-action: manipulation;
            margin: 0px;
            padding: 0px;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            font-weight: normal;
            border: none;
            --pc: calc(min(100vw, calc(100dvh / 16 * 9)) / 100)
        }
        img.streamImage {
            display: block;
            height: auto;
        }
        img.ipsUserPhoto {
            width: calc(15 * var(--pc));
            aspect-ratio: 1 / 1;
            object-fit: cover;
            margin-right: calc(3 * var(--pc));
            border-radius: calc(3 * var(--pc));
        }
        h1 {
            font-size: calc(5 * var(--pc));
            font-weight: bold;
            font-family: Arial, sans-serif;
            overflow-wrap: break-word;
            min-width: 0;
        }
        #heading-container {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #app {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: calc(2.5 * var(--pc));
            width: calc(95 * var(--pc));
            overflow-y: auto;
            background-color: lightblue;
        }
        #app > * {
            width: calc(100% - 5 * var(--pc));
            margin: calc(2.5 * var(--pc));
        }
        body {
            display: flex;
            justify-content: center;
            height: 100dvh;
        }
    </style>
</head>
<body>
    <div id="app">
        <div id="heading-container">
            <img class="ipsUserPhoto" src="">
            <h1 id="heading"></h1>
        </div>
    </div>
    <script>
    (async () => {
        const userId = window.location.hash.substring(1);
        if (!userId) {
            alert("No user ID provided in the URL hash.");
            return;
        }

        const contentPage = await fetch(`https://cptdb.ca/profile/${userId}/content/`);
        const content = new DOMParser().parseFromString(await contentPage.text(), "text/html");
        const userPhotoUrl = content.querySelector('#elProfilePhoto a[href^="https://cptdb.ca/uploads/monthly_"]').href;
        const userContent = content.getElementById("elUserContent");
        const userName = content.getElementsByTagName("h1")[0].textContent.trim();

        userContent.querySelectorAll('a[href^="https://cptdb.ca/uploads/monthly_"]:has(img[src^="https://cptdb.ca/uploads/monthly_"])').forEach((el) => {
            const img = document.createElement("img");
            img.className = "streamImage";
            img.src = el.href;
            document.getElementById("app").appendChild(img);
        });

        document.querySelector(".ipsUserPhoto").src = userPhotoUrl;
        document.getElementById("heading").textContent = userName + "'s Photo Stream";
    })();
    </script>
</body>
</html>